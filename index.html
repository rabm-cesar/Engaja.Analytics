<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard: Engaja Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8; /* Light background to make the dashboard pop */
        }
        .bg-custom-dark {
            background-color: #283546; /* Dark slate blue from reference */
        }
        
        /* Color Scheme */
        .text-verde-engaja { color: #a8e063; } /* Green for branding */
        .text-azul-discreto { color: #60a5fa; } /* Blue for UI highlights */
        .bg-azul-discreto { background-color: #60a5fa; }
        .ring-azul-discreto { ring-color: #60a5fa; }

        .bg-accent-action-hover:hover { background-color: #3b82f6; }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #283546;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #60a5fa;
            border-radius: 10px;
            border: 2px solid #283546;
        }
        .modal {
            display: none;
            transition: opacity 0.3s ease;
        }
        .modal.open {
            display: flex;
        }
        .spinner {
            border-top-color: #60a5fa;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .tab-btn.active {
            background-color: #60a5fa;
            color: #ffffff;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .filter-input {
            background-color: #1f2937;
            border: 1px solid #4b5563;
            color: #d1d5db;
        }
        .chart-type-btn {
            background-color: #374151; /* gray-700 */
            color: #d1d5db; /* gray-300 */
        }
        .chart-type-btn.active {
            background-color: #60a5fa; /* bg-azul-discreto */
            color: #ffffff;
            font-weight: 600;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="bg-custom-dark p-4 sm:p-6 md:p-8 rounded-2xl shadow-2xl text-center w-full max-w-7xl mx-4 my-8 h-[90vh] flex flex-col">
        
        <header class="flex flex-col sm:flex-row items-center justify-between mb-4 pb-4 border-b border-gray-700">
            <div class="flex items-center">
                <div class="w-16 h-auto">
                    <!-- SVG Logo with original green gradient -->
                    <svg viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#76d2c4;" />
                                <stop offset="100%" style="stop-color:#a8e063;" />
                            </linearGradient>
                        </defs>
                        <path d="M 10 50 A 40 40, 0, 0, 1, 90 50" fill="none" stroke="url(#gaugeGradient)" stroke-width="12" stroke-linecap="round"/>
                        <g transform="translate(50, 50) rotate(30)">
                            <path d="M 0 0 L 0 -35" stroke="#ffffff" stroke-width="4" stroke-linecap="round"/>
                        </g>
                        <circle cx="50" cy="50" r="8" fill="#ffffff"/>
                        <path d="M 46 46 L 50 35 L 54 46 Z" fill="#283546"/>
                    </svg>
                </div>
                <div class="text-left ml-4">
                    <h1 class="text-2xl md:text-3xl"><span class="font-bold text-verde-engaja">Engaja</span><span class="font-light text-white">Analytics</span></h1>
                    <p class="text-gray-400 text-xs md:text-sm">Monitorando o engajamento, impulsionando o futuro.</p>
                </div>
            </div>
            <div class="mt-4 sm:mt-0"><h2 class="text-white text-lg font-semibold">Painel de Risco de Turnover</h2></div>
        </header>

        <nav class="mb-4">
            <div class="flex space-x-2 bg-gray-900/50 p-1 rounded-lg">
                <button id="tab-lista" class="tab-btn flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-800/60 transition-colors active">Lista de Colaboradores</button>
                <button id="tab-dashboard" class="tab-btn flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-800/60 transition-colors">Dashboard Geral</button>
            </div>
        </nav>

        <main class="flex-grow overflow-y-auto">
            <div id="content-lista" class="tab-content active">
                <div class="bg-gray-900/50 p-4 rounded-lg mb-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <input type="text" id="filter-name" class="filter-input w-full p-2 rounded-md text-sm" placeholder="Pesquisar por nome...">
                        <select id="filter-department" class="filter-input w-full p-2 rounded-md text-sm"></select>
                        <select id="filter-risk" class="filter-input w-full p-2 rounded-md text-sm">
                            <option value="todos">Todos os Riscos</option>
                            <option value="Alto">Alto</option>
                            <option value="Médio">Médio</option>
                            <option value="Baixo">Baixo</option>
                        </select>
                        <button id="clear-filters-btn" class="bg-gray-700 hover:bg-gray-600 text-white text-sm font-bold py-2 px-4 rounded-md transition-colors">Limpar Filtros</button>
                    </div>
                </div>
                <div class="bg-gray-900/50 p-4 rounded-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-300">
                            <thead class="text-xs text-azul-discreto uppercase bg-gray-800">
                                <tr>
                                    <th scope="col" class="px-6 py-3">Colaborador</th>
                                    <th scope="col" class="px-6 py-3">Departamento</th>
                                    <th scope="col" class="px-6 py-3 text-center">Nível de Risco</th>
                                    <th scope="col" class="px-6 py-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="employee-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="content-dashboard" class="tab-content">
                 <div class="bg-gray-900/50 p-4 rounded-lg h-full flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                         <h3 id="chart-title" class="text-lg font-semibold text-azul-discreto">Distribuição de Risco por Departamento</h3>
                         <div class="flex space-x-1 bg-gray-800 p-1 rounded-md">
                            <button id="chart-type-bar" class="chart-type-btn text-xs px-3 py-1 rounded-md transition-colors active">Por Departamento</button>
                            <button id="chart-type-pie" class="chart-type-btn text-xs px-3 py-1 rounded-md transition-colors">Visão Geral</button>
                         </div>
                    </div>
                    <div class="relative flex-grow">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Detalhes e Ações de IA -->
    <div id="employee-modal" class="modal fixed inset-0 bg-black bg-opacity-75 items-center justify-center p-4">
        <div class="bg-custom-dark rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col ring-2 ring-azul-discreto">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white" id="modal-employee-name"></h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-2xl leading-none" aria-label="Fechar modal">&times;</button>
            </div>
            <div class="p-6 flex-grow overflow-y-auto">
                <div id="employee-details" class="text-gray-300 mb-4"></div>
                <button id="generate-plan-btn" class="w-full bg-azul-discreto bg-accent-action-hover text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition-colors">
                    <span class="mr-2">✨</span> Gerar Plano de Ação com IA
                </button>
                <div id="ai-plan-container" class="mt-4 text-left hidden">
                    <div class="flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-azul-discreto mb-2">Plano de Ação Sugerido</h4>
                        <button id="play-audio-btn" aria-label="Ouvir plano de ação" class="bg-azul-discreto/20 text-azul-discreto p-2 rounded-full hover:bg-azul-discreto/40 disabled:opacity-50 disabled:cursor-not-allowed">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" /></svg>
                        </button>
                    </div>
                    <div id="ai-plan-content" class="bg-gray-900/50 p-4 rounded-lg whitespace-pre-wrap text-gray-300"></div>
                </div>
                 <div id="loading-spinner" class="mt-4 hidden text-center">
                    <div class="spinner h-8 w-8 border-4 border-gray-700 rounded-full mx-auto"></div>
                    <p class="text-azul-discreto mt-2">A IA está a gerar um plano personalizado...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const employees = [
            { id: 1, name: 'Ana Silva', department: 'Vendas', satisfaction: 0.38, evaluation: 0.53, projects: 2, hours: 157, tenure: 3, promotion: 0, risk: 'Alto' },{ id: 2, name: 'Bruno Costa', department: 'Técnico', satisfaction: 0.80, evaluation: 0.86, projects: 5, hours: 262, tenure: 6, promotion: 0, risk: 'Baixo' },{ id: 3, name: 'Carla Dias', department: 'Vendas', satisfaction: 0.11, evaluation: 0.88, projects: 7, hours: 272, tenure: 4, promotion: 0, risk: 'Alto' },{ id: 4, name: 'Diogo Martins', department: 'Suporte', satisfaction: 0.72, evaluation: 0.87, projects: 5, hours: 223, tenure: 5, promotion: 0, risk: 'Médio' },{ id: 5, name: 'Eva Rocha', department: 'RH', satisfaction: 0.59, evaluation: 0.92, projects: 3, hours: 142, tenure: 3, promotion: 1, risk: 'Baixo' },{ id: 6, name: 'Fábio Neves', department: 'Marketing', satisfaction: 0.41, evaluation: 0.50, projects: 2, hours: 153, tenure: 3, promotion: 0, risk: 'Alto' },{ id: 7, name: 'Sofia Pereira', department: 'Técnico', satisfaction: 0.10, evaluation: 0.77, projects: 6, hours: 247, tenure: 4, promotion: 0, risk: 'Alto' },{ id: 8, name: 'Hugo Almeida', department: 'Desenvolvimento', satisfaction: 0.92, evaluation: 0.85, projects: 5, hours: 259, tenure: 5, promotion: 0, risk: 'Baixo' },{ id: 9, name: 'Inês Gomes', department: 'Contabilidade', satisfaction: 0.42, evaluation: 0.53, projects: 2, hours: 142, tenure: 3, promotion: 0, risk: 'Médio' },{ id: 10, name: 'João Ribeiro', department: 'Vendas', satisfaction: 0.78, evaluation: 0.99, projects: 4, hours: 255, tenure: 6, promotion: 0, risk: 'Médio' },{ id: 11, name: 'Laura Mendes', department: 'Design', satisfaction: 0.85, evaluation: 0.95, projects: 4, hours: 180, tenure: 2, promotion: 1, risk: 'Baixo' },{ id: 12, name: 'Miguel Santos', department: 'Operações', satisfaction: 0.55, evaluation: 0.70, projects: 3, hours: 200, tenure: 8, promotion: 0, risk: 'Médio' },{ id: 13, name: 'Nuno Ferreira', department: 'Desenvolvimento', satisfaction: 0.35, evaluation: 0.45, projects: 2, hours: 135, tenure: 3, promotion: 0, risk: 'Alto' },{ id: 14, name: 'Olivia Castro', department: 'Marketing', satisfaction: 0.90, evaluation: 0.88, projects: 6, hours: 240, tenure: 4, promotion: 0, risk: 'Baixo' },{ id: 15, name: 'Pedro Ramos', department: 'Técnico', satisfaction: 0.68, evaluation: 0.82, projects: 4, hours: 210, tenure: 5, promotion: 0, risk: 'Médio' },{ id: 16, name: 'Quintino Aires', department: 'RH', satisfaction: 0.20, evaluation: 0.60, projects: 5, hours: 280, tenure: 7, promotion: 0, risk: 'Alto' },{ id: 17, name: 'Rita Sousa', department: 'Suporte', satisfaction: 0.88, evaluation: 0.91, projects: 3, hours: 160, tenure: 2, promotion: 1, risk: 'Baixo' },{ id: 18, name: 'Sérgio Vieira', department: 'Design', satisfaction: 0.40, evaluation: 0.55, projects: 2, hours: 148, tenure: 3, promotion: 0, risk: 'Alto' },{ id: 19, name: 'Telma Cunha', department: 'Contabilidade', satisfaction: 0.75, evaluation: 0.80, projects: 4, hours: 190, tenure: 9, promotion: 1, risk: 'Baixo' },{ id: 20, name: 'Ulisses Pinto', department: 'Operações', satisfaction: 0.12, evaluation: 0.85, projects: 6, hours: 301, tenure: 4, promotion: 0, risk: 'Alto' },{ id: 21, name: 'Vera Matos', department: 'Vendas', satisfaction: 0.65, evaluation: 0.75, projects: 3, hours: 188, tenure: 3, promotion: 0, risk: 'Médio' },{ id: 22, name: 'Xavier Andrade', department: 'Desenvolvimento', satisfaction: 0.79, evaluation: 0.81, projects: 5, hours: 230, tenure: 6, promotion: 0, risk: 'Baixo' },{ id: 23, name: 'Zélia Brandão', department: 'Marketing', satisfaction: 0.61, evaluation: 0.65, projects: 3, hours: 195, tenure: 5, promotion: 0, risk: 'Médio' },{ id: 24, name: 'António Lopes', department: 'Técnico', satisfaction: 0.82, evaluation: 0.93, projects: 5, hours: 250, tenure: 7, promotion: 1, risk: 'Baixo' },{ id: 25, name: 'Beatriz Moreira', department: 'Suporte', satisfaction: 0.43, evaluation: 0.51, projects: 2, hours: 155, tenure: 3, promotion: 0, risk: 'Alto' },
        ];

        // --- DOM ELEMENTS ---
        const tableBody = document.getElementById('employee-table-body');
        const modal = document.getElementById('employee-modal');
        const modalEmployeeName = document.getElementById('modal-employee-name');
        const employeeDetails = document.getElementById('employee-details');
        const generatePlanBtn = document.getElementById('generate-plan-btn');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const aiPlanContainer = document.getElementById('ai-plan-container');
        const aiPlanContent = document.getElementById('ai-plan-content');
        const loadingSpinner = document.getElementById('loading-spinner');
        const playAudioBtn = document.getElementById('play-audio-btn');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const filterNameInput = document.getElementById('filter-name');
        const filterDepartmentSelect = document.getElementById('filter-department');
        const filterRiskSelect = document.getElementById('filter-risk');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');
        const chartTypeBarBtn = document.getElementById('chart-type-bar');
        const chartTypePieBtn = document.getElementById('chart-type-pie');
        const chartTitle = document.getElementById('chart-title');

        // --- STATE ---
        let currentEmployeeData = null;
        let generatedPlanText = '';
        let riskChart = null;
        let currentChartType = 'bar'; // 'bar' or 'horizontalBar'

        // --- RENDER FUNCTIONS ---
        function getRiskBadge(risk) {
            const colors = { Alto: 'bg-red-500/20 text-red-400', Médio: 'bg-yellow-500/20 text-yellow-400', Baixo: 'bg-green-500/20 text-green-400' };
            return colors[risk] || 'bg-gray-500/20 text-gray-400';
        }

        function populateTable(data) {
            tableBody.innerHTML = '';
            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-gray-400">Nenhum colaborador encontrado.</td></tr>`;
                return;
            }
            data.forEach(emp => {
                const row = document.createElement('tr');
                row.className = 'bg-gray-900 border-b border-gray-800 hover:bg-gray-800/50';
                row.innerHTML = `<td class="px-6 py-4 font-medium text-white whitespace-nowrap">${emp.name}</td><td class="px-6 py-4">${emp.department}</td><td class="px-6 py-4 text-center"><span class="px-2 py-1 text-xs font-semibold rounded-full ${getRiskBadge(emp.risk)}">${emp.risk}</span></td><td class="px-6 py-4 text-center"><button data-id="${emp.id}" class="view-details-btn font-medium text-azul-discreto hover:underline">Ver Detalhes</button></td>`;
                tableBody.appendChild(row);
            });
            addTableButtonListeners();
        }
        
        // --- CHARTING ---
        function getRiskColor(risk, opacity = 0.7) {
            const colors = { Alto: `rgba(239, 68, 68, ${opacity})`, Médio: `rgba(234, 179, 8, ${opacity})`, Baixo: `rgba(34, 197, 94, ${opacity})` };
            return colors[risk] || `rgba(156, 163, 175, ${opacity})`;
        }

        function processBarChartData(data) {
            const departments = {};
            data.forEach(emp => {
                if (!departments[emp.department]) departments[emp.department] = { 'Baixo': 0, 'Médio': 0, 'Alto': 0 };
                departments[emp.department][emp.risk]++;
            });
            const labels = Object.keys(departments).sort();
            const datasets = ['Baixo', 'Médio', 'Alto'].map(risk => ({
                label: risk,
                data: labels.map(dept => departments[dept][risk]),
                backgroundColor: getRiskColor(risk),
            }));
            return { labels, datasets };
        }

        function processOverallData(data) {
            const riskCounts = { 'Baixo': 0, 'Médio': 0, 'Alto': 0 };
            data.forEach(emp => riskCounts[emp.risk]++);
            const labels = ['Baixo', 'Médio', 'Alto'];
            const datasets = [{
                label: 'Nº de Colaboradores',
                data: labels.map(risk => riskCounts[risk]),
                backgroundColor: labels.map(risk => getRiskColor(risk, 1)),
            }];
            return { labels, datasets };
        }

        function renderDashboardChart(data) {
            const ctx = document.getElementById('riskChart').getContext('2d');
            if (riskChart) riskChart.destroy();
            
            let chartData, chartOptions, chartType;
            
            if (currentChartType === 'bar') {
                chartType = 'bar';
                chartData = processBarChartData(data);
                chartOptions = {
                    scales: {
                        x: { stacked: true, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                        y: { stacked: true, beginAtZero: true, ticks: { color: '#9ca3af', stepSize: 1 }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                    },
                    plugins: { 
                        legend: { position: 'top', labels: { color: '#d1d5db' } } 
                    }
                };
            } else { // horizontalBar
                chartType = 'bar';
                chartData = processOverallData(data);
                chartOptions = {
                    indexAxis: 'y',
                    scales: {
                        x: { beginAtZero: true, ticks: { color: '#9ca3af', stepSize: 1 }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                        y: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.05)' } }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                };
            }

            riskChart = new Chart(ctx, {
                type: chartType,
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    ...chartOptions
                }
            });
        }

        // --- MODAL ---
        function openModal(employee) {
            currentEmployeeData = employee;
            generatedPlanText = '';
            modalEmployeeName.textContent = `Plano de Retenção: ${employee.name}`;
            employeeDetails.innerHTML = `<p><strong>Departamento:</strong> ${employee.department}</p><p><strong>Nível de Satisfação:</strong> ${employee.satisfaction}</p><p><strong>Última Avaliação:</strong> ${employee.evaluation}</p><p><strong>Projetos Atuais:</strong> ${employee.projects}</p><p><strong>Média de Horas/Mês:</strong> ${employee.hours}</p><p><strong>Tempo de Empresa:</strong> ${employee.tenure} anos</p><p><strong>Promoção (5 anos):</strong> ${employee.promotion ? 'Sim' : 'Não'}</p>`;
            generatePlanBtn.disabled = false;
            aiPlanContainer.classList.add('hidden');
            loadingSpinner.classList.add('hidden');
            playAudioBtn.disabled = true;
            modal.classList.add('open');
        }

        function closeModal() { modal.classList.remove('open'); }

        // --- FILTERS & TABS ---
        function applyFilters() {
            const nameFilter = filterNameInput.value.toLowerCase();
            const departmentFilter = filterDepartmentSelect.value;
            const riskFilter = filterRiskSelect.value;
            const filteredEmployees = employees.filter(emp => 
                emp.name.toLowerCase().includes(nameFilter) &&
                (departmentFilter === 'todos' || emp.department === departmentFilter) &&
                (riskFilter === 'todos' || emp.risk === riskFilter)
            );
            populateTable(filteredEmployees);
            renderDashboardChart(filteredEmployees);
        }

        function populateDepartmentFilter() {
            const departments = [...new Set(employees.map(emp => emp.department))];
            filterDepartmentSelect.innerHTML = '<option value="todos">Todos os Departamentos</option>';
            departments.sort().forEach(dept => {
                filterDepartmentSelect.innerHTML += `<option value="${dept}">${dept}</option>`;
            });
        }

        // --- API & AI FUNCTIONS (Placeholder) ---
        async function fetchWithBackoff(apiUrl, payload, maxRetries = 5) { /* API logic */ return null; }
        async function handleGeneratePlan() { 
            loadingSpinner.classList.remove('hidden');
            aiPlanContainer.classList.add('hidden');
            generatePlanBtn.disabled = true;
            
            // Mock AI response
            setTimeout(() => {
                generatedPlanText = `Plano de Ação para ${currentEmployeeData.name}:\n\n1. Feedback e Reconhecimento: Agendar uma reunião 1:1 para discutir a sua avaliação de performance (${currentEmployeeData.evaluation}) e o nível de satisfação (${currentEmployeeData.satisfaction}). Reconhecer as suas contribuições nos ${currentEmployeeData.projects} projetos.\n\n2. Desenvolvimento de Carreira: Discutir oportunidades de crescimento, considerando que não houve promoção nos últimos 5 anos. Criar um plano de desenvolvimento individual (PDI).\n\n3. Equilíbrio e Carga de Trabalho: Avaliar a média de ${currentEmployeeData.hours} horas mensais para garantir que não há sobrecarga. Oferecer flexibilidade se necessário.`;
                aiPlanContent.textContent = generatedPlanText;
                loadingSpinner.classList.add('hidden');
                aiPlanContainer.classList.remove('hidden');
                generatePlanBtn.disabled = false;
                playAudioBtn.disabled = false;
            }, 1500);
        }
        function base64ToArrayBuffer(base64) { /* TTS logic */ }
        function pcmToWav(pcmData, sampleRate) { /* TTS logic */ }
        async function handlePlayAudio() { /* TTS API logic */ 
            alert('Funcionalidade de áudio não implementada neste demo.');
        }
        
        // --- EVENT LISTENERS ---
        function addTableButtonListeners() {
            document.querySelectorAll('.view-details-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const employee = employees.find(emp => emp.id === parseInt(e.target.dataset.id));
                    openModal(employee);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateDepartmentFilter();
            applyFilters();
        });

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                document.getElementById(button.id.replace('tab-', 'content-')).classList.add('active');
            });
        });
        
        [filterNameInput, filterDepartmentSelect, filterRiskSelect].forEach(el => el.addEventListener('input', applyFilters));

        clearFiltersBtn.addEventListener('click', () => {
            filterNameInput.value = '';
            filterDepartmentSelect.value = 'todos';
            filterRiskSelect.value = 'todos';
            applyFilters();
        });
        
        chartTypeBarBtn.addEventListener('click', () => {
            currentChartType = 'bar';
            chartTitle.textContent = 'Distribuição de Risco por Departamento';
            chartTypeBarBtn.classList.add('active');
            chartTypePieBtn.classList.remove('active');
            applyFilters();
        });

        chartTypePieBtn.addEventListener('click', () => {
            currentChartType = 'horizontalBar';
            chartTitle.textContent = 'Visão Geral do Risco (Filtrado)';
            chartTypePieBtn.classList.add('active');
            chartTypeBarBtn.classList.remove('active');
            applyFilters();
        });

        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
        generatePlanBtn.addEventListener('click', handleGeneratePlan);
        playAudioBtn.addEventListener('click', handlePlayAudio);
    </script>
</body>
</html>
